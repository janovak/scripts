#!/bin/bash

# Define the services you want to manage
SERVICES=(
    "rate_limiter_service.py"
    "chat_listener_service.py"
    "twitch_polling_service.py"
    "anomaly_detection_service.py"
    "clip_creation_service.py"
)

# Function to start services
start_services() {
    for service in "${SERVICES[@]}"; do
        echo "Starting $service..."
        start_service "$service"
    done
}

# Function to stop services
stop_services() {
    for service in "${SERVICES[@]}"; do
        echo "Stopping $service..."
        stop_service "$service"
    done
}

purge_queues() {
    echo "Purging all RabbitMQ queues..."

    # Store the queue names in a variable
    queues=$(sudo rabbitmqctl list_queues | awk '{print $1}' | grep -v 'Timeout:\|Listing\|name')

    # Loop through each queue and purge it
    for queue in $queues; do
        echo "Purging queue: $queue"
        sudo rabbitmqctl purge_queue "$queue"
    done
}

# Main script logic
if [[ $1 == "start" ]]; then
    start_services
elif [[ $1 == "stop" ]]; then
    stop_services
elif [[ $1 == "purge_queues" ]]; then
    purge_queues
elif [[ $1 == "restart" ]]; then
    stop_services
    purge_queues
    start_services
else
    echo "Usage: $0 {start|stop|purge_queues|restart}"
    exit 1
fi

